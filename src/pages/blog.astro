---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Section from "@/components/Section.astro";
import BlogCard from "@/components/BlogCard.astro";
import "@/styles/colors.css";

const allPosts = await getCollection("blog");
const publishedPosts = allPosts
	.filter((post) => !post.data.draft)
	.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<Layout title="Blog - Marcelo Rondon">
	<Section>
		<h1>Blog</h1>
		<p class="intro">Thoughts on code, design, and creative development.</p>
	</Section>

	<Section>
		{publishedPosts.length > 0 ? (
			<div class="blog-grid">
				{publishedPosts.map((post, i) => (
					<BlogCard
						title={post.data.title}
						description={post.data.description}
						publishDate={post.data.publishDate}
						image={post.data.image}
						tags={post.data.tags}
						slug={post.slug}
						index={i}
					/>
				))}
			</div>
		) : (
			<p class="empty">No posts yet. Check back soon!</p>
		)}
	</Section>
</Layout>

<script is:inline>
	function setTheme(theme) {
		document.documentElement.setAttribute("data-theme", theme);
		localStorage.setItem("theme", theme);
	}

	document.addEventListener("DOMContentLoaded", () => {
		const savedTheme = localStorage.getItem("theme") || "dark";
		setTheme(savedTheme);
	});

	document.addEventListener("astro:after-swap", () => {
		const savedTheme = localStorage.getItem("theme") || "dark";
		setTheme(savedTheme);
	});
</script>

<style>
	h1 {
		font-size: 2.5rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		color: var(--color-accent);
		margin-bottom: 0;
	}

	.intro {
		color: var(--color-text);
		opacity: 0.8;
		margin-top: 0.5rem;
	}

	.blog-grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: 2rem;
	}

	.empty {
		text-align: center;
		color: var(--color-text);
		opacity: 0.6;
		font-size: 1.1rem;
	}

	@media (width <= 700px) {
		.blog-grid {
			grid-template-columns: 1fr;
		}
	}
</style>
