---
import "@/styles/colors.css";

interface Props {
	title: string;
	description: string;
	category: "packaging" | "graphic" | "motion" | "video" | "photography";
	image?: string;
	tags?: string[];
	slug: string;
	index?: number;
}

const { title, description, category, image, tags = [], slug, index = 0 } = Astro.props;

const isVideo = image?.endsWith('.webm') || image?.endsWith('.mp4');
---

<article class="card has-texture-hover" style={`--i: ${index}`}>
	<a href={`/visuals/${slug}`} class="card-link">
		{image && (
			<div class="image-box">
				{isVideo ? (
					<video src={image} autoplay loop muted playsinline />
				) : (
					<img src={image} alt={title} loading="lazy" />
				)}
				<div class="image-accent"></div>
			</div>
		)}
		<div class="content">
			<span class="category">{category}</span>
			<h3>{title}</h3>
			<div class="bar"></div>
			<p>{description}</p>
		</div>
	</a>
	{tags.length > 0 && (
		<footer>
			<ul class="tags">
				{tags.slice(0, 4).map((tag) => (
					<li>{tag}</li>
				))}
			</ul>
		</footer>
	)}
</article>

<style>
	.card {
		position: relative;
		background: var(--color-background);
		border: 3px solid var(--color-text);
		overflow: hidden;
		animation: slideUp 0.7s cubic-bezier(0.16, 1, 0.3, 1) backwards;
		animation-delay: calc(var(--i) * 0.1s);
	}

	.card::before {
		content: "";
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: var(--color-accent);
		transform: translateX(-101%);
		transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
		z-index: 0;
	}

	.card:hover::before {
		transform: translateX(0);
	}

	.card:hover {
		border-color: var(--color-accent);
	}

	.card:hover .content,
	.card:hover footer {
		color: var(--color-background);
	}

	.card:hover .category {
		color: var(--color-background);
		border-color: var(--color-background);
	}

	.card:hover .bar {
		background: var(--color-background);
	}

	.card:hover .tags li {
		border-color: var(--color-background);
		color: var(--color-background);
	}

	.card-link {
		display: block;
		color: inherit;
		position: relative;
		z-index: 1;
	}

	.image-box {
		position: relative;
		overflow: hidden;
		aspect-ratio: 16/10;
	}

	.image-box:has(video) {
		aspect-ratio: auto;
	}

	video {
		width: 100%;
		height: auto;
		transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
		filter: grayscale(20%);
	}

	img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
		filter: grayscale(20%);
	}

	.card:hover img,
	.card:hover video {
		transform: scale(1.08);
		filter: grayscale(0%);
	}

	.image-accent {
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
		height: 40%;
		background: linear-gradient(to top, var(--color-background) 0%, transparent 100%);
		pointer-events: none;
		transition: opacity 0.3s ease;
	}

	.card:hover .image-accent {
		opacity: 0;
	}

	.content {
		padding: 1.25rem;
		position: relative;
		z-index: 1;
		transition: color 0.3s ease;
	}

	.category {
		display: inline-block;
		font-size: 0.75rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.1em;
		color: var(--color-accent);
		border: 2px solid var(--color-accent);
		padding: 0.25rem 0.5rem;
		margin-bottom: 0.75rem;
		transition: all 0.3s ease;
	}

	h3 {
		font-size: 1.5rem;
		font-weight: 900;
		text-transform: uppercase;
		line-height: 1;
		margin: 0 0 0.75rem;
		padding: 0;
		letter-spacing: -0.02em;
	}

	.bar {
		width: 60px;
		height: 4px;
		background: var(--color-accent);
		margin-bottom: 0.75rem;
		transition: background 0.3s ease;
	}

	p {
		font-size: 0.9rem;
		line-height: 1.5;
		margin: 0;
		padding: 0;
		opacity: 0.85;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	footer {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 1rem 1.25rem;
		border-top: 2px solid var(--color-text);
		position: relative;
		z-index: 1;
		transition: color 0.3s ease, border-color 0.3s ease;
	}

	.card:hover footer {
		border-color: var(--color-background);
	}

	.tags {
		display: flex;
		gap: 0.4rem;
		flex-wrap: wrap;
	}

	.tags li {
		font-size: 0.7rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		padding: 0.2rem 0.4rem;
		border: 1px solid var(--color-text);
		transition: all 0.3s ease;
	}

	@keyframes slideUp {
		from {
			opacity: 0;
			transform: translateY(40px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@media (width <= 700px) {
		h3 {
			font-size: 1.25rem;
		}

		.content {
			padding: 1rem;
		}

		footer {
			padding: 0.75rem 1rem;
		}
	}
</style>
